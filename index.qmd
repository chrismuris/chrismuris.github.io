---
format:
  html:
    page-layout: article
    toc: false
    include-in-header:
      text: |
        <link rel="shortcut icon" href="profile_pic.jpg">
        <meta property="og:description" content="Associate Professor of Economics at McMaster University specializing in theoretical econometrics and panel data.">
        <meta property="og:image" content="profile_pic.jpg">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="profile_pic.jpg">
---

:::{.profile-header}
:::{.profile-pic-container}
<img src="profile_pic.jpg" class="profile-pic-main">
:::

:::{.profile-info}
:::{.profile-links-grid}
<a href="./CV/CV_ChrisMuris.pdf" class="btn btn-primary" target="_blank">
  <i class="bi bi-file-earmark-person me-2"></i> CV
</a>
<a href="mailto:muerisc@mcmaster.ca" class="btn btn-outline-primary"><i class="bi bi-envelope"></i> Email</a>
<a href="https://scholar.google.com/citations?user=zh8YkR8AAAAJ&hl=en" class="btn btn-outline-primary" target="_blank"><i class="bi bi-mortarboard"></i> Scholar</a>
<a href="https://github.com/chrismuris" class="btn btn-outline-primary" target="_blank"><i class="bi bi-github"></i> Github</a>
<a href="https://arxiv.org/a/0000-0003-2781-3514.html" class="btn btn-outline-primary" target="_blank"><i class="bi bi-journal-text"></i> Arxiv</a>
<a href="https://www.linkedin.com/in/chris-muris-4b5b03382" class="btn btn-outline-primary" target="_blank"><i class="bi bi-linkedin"></i> LinkedIn</a>
<a href="https://orcid.org/0000-0003-2781-3514" class="btn btn-outline-primary" target="_blank"><i class="bi bi-person-badge"></i> ORCID</a>
:::
:::
:::

<div class="lead">
I am an associate professor in the Department of Economics at McMaster University. 
My research is in the area of theoretical econometrics.
I develop and study new tools for the analysis of panel (longitudinal) data.
</div>

```{r}
#| echo: false
#| warning: false
#| message: false

library(yaml)
library(reactable)
library(htmltools)
library(dplyr)
library(purrr)

# Javascript for Clipboard Copy
htmltools::tagList(
  tags$script(HTML(
    "\n    function copyToClipboard(text) {\n      if (navigator.clipboard && window.isSecureContext) {\n        navigator.clipboard.writeText(text).then(function() {\n          alert('BibTeX copied to clipboard!');\n        }, function(err) {\n          console.error('Async: Could not copy text: ', err);\n        });\n      } else {\n        // Fallback for non-secure contexts (if any)\n        let textArea = document.createElement('textarea');\n        textArea.value = text;\n        document.body.appendChild(textArea);\n        textArea.focus();\n        textArea.select();\n        try {\n          document.execCommand('copy');\n          alert('BibTeX copied to clipboard!');\n        } catch (err) {\n          console.error('Fallback: Unable to copy', err);\n        }\n        document.body.removeChild(textArea);\n      }\n    }\n  "))
)

# Load data
pubs <- yaml::read_yaml("publications.yml")

# Convert to data frame
df <- pubs |>
  map_dfr(function(x) {
    # Handle Code: Can be string or list. Store as a list to be safe.
    code_val <- if (is.null(x$code)) {
      list() 
    } else if (is.character(x$code)) {
      list(list(name = "Code", url = x$code))
    } else {
      x$code
    }
    
    # Generate BibTeX ID (AuthorYear)
    first_author_last <- strsplit(strsplit(x$author, ",")[[1]][1], " ")[[1]]
    first_author_last <- first_author_last[length(first_author_last)]
    bib_id <- paste0(first_author_last, x$year)
    
    # Generate BibTeX String
    bib_type <- if(x$type == "journal_article") "article" else "workingpaper"
    bib_str <- paste0(
      "@", bib_type, "{", bib_id, ",\n",
      "  title = {", x$title, "},\n",
      "  author = {", gsub(",", " and", x$author), "},\n",
      "  year = {", x$year, "},\n",
      if (!is.null(x$journal)) paste0("  journal = {", x$journal, "},\n") else "",
      if (!is.null(x$volume)) paste0("  volume = {", x$volume, "},\n") else "",
      if (!is.null(x$issue)) paste0("  number = {", x$issue, "},\n") else "",
      if (!is.null(x$pages)) paste0("  pages = {", x$pages, "},\n") else "",
      if (!is.null(x$doi)) paste0("  doi = {", x$doi, "},\n") else "",
      if (!is.null(x$url)) paste0("  url = {", x$url, "}\n") else "",
      "}"
    )

    tibble(
      year = as.character(x$year),
      title = x$title,
      author = x$author,
      journal = ifelse(is.null(x$journal), "", x$journal),
      status = ifelse(is.null(x$status), "", x$status),
      type = ifelse(is.null(x$type), "journal_article", x$type),
      abstract = ifelse(is.null(x$abstract), "", x$abstract),
      doi = ifelse(is.null(x$doi), NA, x$doi),
      url = ifelse(is.null(x$url), NA, x$url),
      code = list(code_val), # Store as list-column
      slides = ifelse(is.null(x$slides), NA, x$slides),
      bibtex = bib_str, # Store BibTeX
      # Bibliographic Info
      volume = ifelse(is.null(x$volume), NA, x$volume),
      issue = ifelse(is.null(x$issue), NA, x$issue),
      pages = ifelse(is.null(x$pages), NA, x$pages)
    )
  }) |>
  arrange(desc(year))

# Helper function to render table
render_pubs_table <- function(data, searchable = TRUE, show_buttons_inline = TRUE, show_buttons_in_details = FALSE) {
  reactable(
    data,
    searchable = searchable,
    columns = list(
      # Hide standard columns but keep them searchable
      year = colDef(show = FALSE, searchable = TRUE),
      author = colDef(show = FALSE, searchable = TRUE),
      journal = colDef(show = FALSE, searchable = TRUE),
      status = colDef(show = FALSE),
      type = colDef(show = FALSE),
      abstract = colDef(show = FALSE, searchable = TRUE),
      doi = colDef(show = FALSE),
      url = colDef(show = FALSE),
      code = colDef(show = FALSE),
      slides = colDef(show = FALSE),
      bibtex = colDef(show = FALSE),
      volume = colDef(show = FALSE),
      issue = colDef(show = FALSE),
      pages = colDef(show = FALSE),

      # Main Citation Column
      title = colDef(
        name = "", # No header
        cell = function(value, index) {
          row <- data[index, ]
          
          # 1. Authors: Split, Sort by Last Name, Format
          auths <- trimws(unlist(strsplit(row$author, ",")))
          
          # Sort by last name (assume format "First Last")
          last_names <- sapply(auths, function(x) {
            parts <- unlist(strsplit(x, " "))
            parts[length(parts)]
          })
          auths <- auths[order(last_names)]
          
          if (length(auths) > 1) {
            last_auth <- auths[length(auths)]
            other_auths <- auths[-length(auths)]
            auth_str <- paste0(paste(other_auths, collapse = ", "), " and ", last_auth)
          } else {
            auth_str <- auths
          }
          
          # 2. Title Link
          doi_val <- row$doi
          url_val <- row$url
          final_url <- NA
          if (!is.na(doi_val) && doi_val != "") {
             final_url <- paste0("https://doi.org/", doi_val)
          } else if (!is.na(url_val) && url_val != "") {
             final_url <- url_val
          }
          
          title_el <- if (!is.na(final_url)) {
            a(href = final_url, target = "_blank", 
              style = "text-decoration: none; color: #1a5276; font-weight: 500;", 
              onclick = "event.stopPropagation();", # Prevent row toggle when clicking link
              row$title
            )
          } else {
            span(style = "font-weight: 500;", row$title)
          }
          
          # 3. Journal / Venue Info
          venue_part <- NULL
          if (!is.na(row$journal) && row$journal != "") {
             j_text <- tags$i(row$journal)
             
             # Check for forthcoming status: if volume/pages are missing
             is_forthcoming <- (is.na(row$volume) || row$volume == "") && 
                               (is.na(row$pages) || row$pages == "")
             
             if (is_forthcoming) {
                venue_part <- span(j_text, ", forthcoming")
             } else {
                vol_text <- NULL
                if (!is.na(row$volume) && row$volume != "") vol_text <- paste0(", ", row$volume)
                
                iss_text <- NULL
                if (!is.na(row$issue) && row$issue != "") iss_text <- paste0("(", row$issue, ")")
                
                pg_text <- NULL
                if (!is.na(row$pages) && row$pages != "") pg_text <- paste0(": ", row$pages)
                
                venue_part <- span(j_text, vol_text, iss_text, pg_text)
             }
          }

          # 4. Determine Punctuation
          # If we have a venue, end title with comma. If not, end with period.
          suffix <- if (!is.null(venue_part)) "," else "."

          # 5. Title (Quoted with Punctuation)
          title_text <- paste0("“", row$title, suffix, "”")
          
          title_el <- if (!is.na(final_url)) {
            a(href = final_url, target = "_blank", 
              style = "text-decoration: none; color: #1a5276; font-weight: 500;", 
              onclick = "event.stopPropagation();", 
              title_text
            )
          } else {
            span(style = "font-weight: 500;", title_text)
          }

          # 6. Generate Buttons (Inline)
          btns_div_inline <- NULL
          if (show_buttons_inline) {
            doi_link <- if (!is.na(row$doi) && row$doi != "") paste0("https://doi.org/", row$doi) else NA
            url_link <- if (!is.na(row$url) && row$url != "") row$url else NA

            paper_btn <- if (!is.na(doi_link)) {
                a(href = doi_link, onclick = "event.stopPropagation();",
                  class = "btn btn-sm btn-outline-primary", target = "_blank",
                  style = "font-size: 0.75rem; padding: 2px 8px;",
                  tags$i(class = "bi bi-file-earmark-text me-1"), "Paper")
            } else if (!is.na(url_link)) {
                a(href = url_link, onclick = "event.stopPropagation();",
                  class = "btn btn-sm btn-outline-primary", target = "_blank",
                  style = "font-size: 0.75rem; padding: 2px 8px;",
                  tags$i(class = "bi bi-file-earmark-text me-1"), "Paper")
            } else NULL

            preprint_btn <- if (!is.na(doi_link) && !is.na(url_link) && url_link != doi_link) {
                a(href = url_link, onclick = "event.stopPropagation();",
                  class = "btn btn-sm btn-outline-secondary", target = "_blank",
                  style = "font-size: 0.75rem; padding: 2px 8px;",
                  tags$i(class = "bi bi-file-earmark-pdf me-1"), "Preprint")
            } else NULL

            code_btns <- NULL
            if (length(row$code[[1]]) > 0) {
              code_btns <- lapply(row$code[[1]], function(c_item) {
                 a(href = c_item$url, onclick = "event.stopPropagation();",
                  class = "btn btn-sm btn-outline-dark", target = "_blank",
                  style = "font-size: 0.75rem; padding: 2px 8px;",
                  tags$i(class = "bi bi-github me-1"), c_item$name)
              })
            }

            slides_btn <- if (!is.na(row$slides)) {
                a(href = row$slides, onclick = "event.stopPropagation();",
                  class = "btn btn-sm btn-outline-secondary", target = "_blank",
                  style = "font-size: 0.75rem; padding: 2px 8px;",
                  tags$i(class = "bi bi-easel me-1"), "Slides")
            } else NULL

            cite_btn <- tags$button(
              class = "btn btn-sm btn-outline-info",
              style = "font-size: 0.75rem; padding: 2px 8px;",
              onclick = paste0("event.stopPropagation(); copyToClipboard(`", row$bibtex, "`)"),
              tags$i(class = "bi bi-quote me-1"), "Cite"
            )

            btns_div_inline <- span(
              class = "d-inline-flex gap-2 ms-2 flex-wrap", 
              style = "vertical-align: middle; width: auto;",
              paper_btn, preprint_btn, code_btns, slides_btn, cite_btn
            )
          }
          
          # Combine: Chevron + Citation + Buttons
          div(
            class = "pub-citation-container",
            style = "font-family: 'Roboto', sans-serif; line-height: 1.6; color: #333; padding-left: 20px; text-indent: -20px; margin-bottom: 12px; display: block;",
            
            # Expander Indicator (Chevron)
            span(class = "me-2", style = "text-indent: 0px; display: inline-block; width: 15px; color: #999;", 
                 tags$i(class = "bi bi-chevron-right small")),

            span(
              class = "pub-citation",
              span(style = "font-weight: 500;", auth_str),
              span(paste0(" (", row$year, "): ")),
              title_el,
              if (!is.null(venue_part)) span(" ", venue_part, span(". "))
            ),
            btns_div_inline
          )
        }
      )
    ),
    details = function(index) {
      row <- data[index, ]
      
      # Buttons if requested (for Working Papers)
      details_btns <- NULL
      if (show_buttons_in_details) {
          doi_link <- if (!is.na(row$doi) && row$doi != "") paste0("https://doi.org/", row$doi) else NA
          url_link <- if (!is.na(row$url) && row$url != "") row$url else NA

          paper_btn <- if (!is.na(doi_link)) {
              a(href = doi_link, class = "btn btn-sm btn-outline-primary", target = "_blank",
                tags$i(class = "bi bi-file-earmark-text me-1"), "Paper")
          } else if (!is.na(url_link)) {
              a(href = url_link, class = "btn btn-sm btn-outline-primary", target = "_blank",
                tags$i(class = "bi bi-file-earmark-text me-1"), "Paper")
          } else NULL

          preprint_btn <- if (!is.na(doi_link) && !is.na(url_link) && url_link != doi_link) {
              a(href = url_link, class = "btn btn-sm btn-outline-secondary", target = "_blank",
                tags$i(class = "bi bi-file-earmark-pdf me-1"), "Preprint")
          } else NULL

          code_btns <- NULL
          if (length(row$code[[1]]) > 0) {
            code_btns <- lapply(row$code[[1]], function(c_item) {
               a(href = c_item$url, class = "btn btn-sm btn-outline-dark", target = "_blank",
                tags$i(class = "bi bi-github me-1"), c_item$name)
            })
          }

          slides_btn <- if (!is.na(row$slides)) {
              a(href = row$slides, class = "btn btn-sm btn-outline-secondary", target = "_blank",
                tags$i(class = "bi bi-easel me-1"), "Slides")
          } else NULL

          cite_btn <- tags$button(
            class = "btn btn-sm btn-outline-info",
            onclick = paste0("copyToClipboard(`", row$bibtex, "`)"),
            tags$i(class = "bi bi-quote me-1"), "Cite"
          )

          details_btns <- div(class = "d-flex gap-2 mb-3 flex-wrap", paper_btn, preprint_btn, code_btns, slides_btn, cite_btn)
      }

      # Content
      if (nchar(row$abstract) > 0 || !is.null(details_btns)) {
        div(
          class = "p-4 bg-light border-top",
          details_btns,
          if (nchar(row$abstract) > 0) p(class = "abstract-text text-muted mb-0", 
            style = "font-family: 'Roboto', sans-serif; font-size: 0.95rem; text-align: left; max-width: 800px; line-height: 1.6;", 
            row$abstract) else NULL
        )
      } else {
        NULL
      }
    },
    pagination = FALSE,
    highlight = TRUE,
    striped = FALSE,
    outlined = FALSE,
    borderless = TRUE,
    width = "100%",
    theme = reactableTheme(
      cellPadding = "12px 0px",
      searchInputStyle = list(width = "100%", marginBottom = "10px"),
      headerStyle = list(display = "none")
    ),
    onClick = "expand",
    class = "custom-reactable"
  )
}

# Split data
pubs_df <- df |> filter(type == "journal_article")
wp_df <- df |> filter(type != "journal_article")
```

## Working Papers

```{r}
#| echo: false
render_pubs_table(wp_df, searchable = FALSE, show_buttons_inline = FALSE, show_buttons_in_details = TRUE)
```

## Publications

```{r}
#| echo: false
render_pubs_table(pubs_df)
```